<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="category">
	<select id="list" resultType="categoryDto">
 	select  cateLevel, cateName, cateCode, cateCodeRef
 		from goods_category
     start with cateCodeRef is null connect by prior cateCode = cateCodeRef
	</select>
	<insert id="itemInsert" parameterType="ItemDto">
		insert into tbl_items (itemNum, itemName, cateCode, itemPrice, itemCount, itemDes, itemImg, itemThumbImg)
		values (tbl_item_seq.nextval, #{itemName}, #{cateCode}, #{itemPrice}, #{itemCount}, #{itemDes}, #{itemImg}, #{itemThumbImg})
	</insert>
	<select id="itemSelect"  resultType="ItemDto">
		select itemNum, itemName, cateCode, itemPrice, itemCount, itemDes, itemImg, itemDate
 		from tbl_items
 		order by itemNum desc
	</select>
	<select id="itemViewContent" parameterType="ItemDto" resultType="ItemDto">
		 select itemNum, itemName, cateCode, itemPrice, itemCount, itemDes, itemImg, itemDate
     	from tbl_Items
         where itemNum = #{itemNum}
	</select>
	<select id="itemViewData" parameterType="ItemViewDto" resultType="ItemViewDto">
		 select i.itemNum, i.itemName, i.cateCode, c.cateCodeRef, c.cateName, itemPrice, itemCount, itemDes, itemImg, itemDate, itemThumbImg
         from tbl_items i
         inner join goods_category c
         on i.cateCode = c.cateCode          
         where i.itemNum = #{itemNum}
	</select>
	<update id="itemUpDate" parameterType="ItemDto">
		 update tbl_Items
     	 set itemName = #{itemName},
         cateCode = #{cateCode},
         itemPrice = #{itemPrice},
         itemCount = #{itemCount},
         itemDes = #{itemDes},
         itemImg = #{itemImg},
         itemThumbImg = #{itemThumbImg}
         where itemNum = #{itemNum}
	</update>
	
	<delete id="itemDelete">
		delete from tbl_items where itemNum = #{itemNum}
	</delete>

	<update id="minusCount" parameterType="orderDetailDto">
		update tbl_items
		set itemCount=itemCount-#{quantity}
		where itemNum=#{itemNum}
	</update>
	
	<select id="select_user_orders" resultType="User_Orders_Dto">
		select tbl_member.userId, tbl_member.verify, orders.delivery, orders.orderNum
		from tbl_member left join orders on tbl_member.userId=orders.userId
		where orders.delivery is not null
		order by userId desc
	</select>
	<select id="select_item_order_detail" resultType="Item_OrderDetail_Dto">
		select tbl_items.itemName, order_detail.result, order_detail.orderNum, order_detail.odNum
		from order_detail left join tbl_items on tbl_items.itemNum=order_detail.itemNum 
		where order_detail.result is not null
		order by odnum desc
	</select>
	<update id="resultItem" parameterType="orderDetailDto">
		 update order_detail
     	 set result = #{result}
         where odNum = #{odNum}
	</update>
	<select id="userAllList" resultType="UsersDto">
		select * from tbl_member
	</select>
	<update id="userVerify">
		update tbl_member
		set verify = #{verify}
		where userId = #{userId}	
	</update>
</mapper>